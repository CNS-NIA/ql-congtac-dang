<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chương trình Quản lý Công tác Đảng</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Reset và Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-red: #8B0000;
            --secondary-red: #A93226;
            --light-red: #F8D7DA;
            --dark-red: #5A0000;
            --gold: #D4AF37;
            --light-gold: #F7EFD9;
            --dark-gray: #2C3E50;
            --medium-gray: #546E7A;
            --light-gray: #ECEFF1;
            --white: #FFFFFF;
            --success: #28A745;
            --warning: #FFC107;
            --info: #17A2B8;
            --danger: #DC3545;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.15);
            --shadow-lg: 0 8px 16px rgba(0,0,0,0.2);
            --shadow-xl: 0 12px 24px rgba(0,0,0,0.25);
            --border-radius-sm: 8px;
            --border-radius: 12px;
            --border-radius-lg: 16px;
            --border-radius-xl: 20px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        body {
            font-family: 'Inter', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            color: var(--dark-gray);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
            font-weight: 400;
        }
        
        /* Loading Overlay */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.95) 0%, rgba(169, 50, 38, 0.95) 100%);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
            backdrop-filter: blur(5px);
        }
        
        #loading-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .spinner {
            width: 70px;
            height: 70px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 25px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 100px;
            right: 30px;
            padding: 16px 20px;
            border-radius: var(--border-radius);
            color: var(--white);
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: var(--shadow-xl);
            z-index: 10000;
            animation: slideInRight 0.3s ease;
            max-width: 350px;
            min-width: 300px;
            font-weight: 500;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .toast-success { 
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.9) 0%, rgba(33, 136, 56, 0.9) 100%);
            border-left: 4px solid #1e7e34;
        }
        
        .toast-error { 
            background: linear-gradient(135deg, rgba(220, 53, 69, 0.9) 0%, rgba(200, 35, 51, 0.9) 100%);
            border-left: 4px solid #bd2130;
        }
        
        .toast-info { 
            background: linear-gradient(135deg, rgba(23, 162, 184, 0.9) 0%, rgba(19, 132, 150, 0.9) 100%);
            border-left: 4px solid #117a8b;
        }
        
        .toast-warning { 
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.9) 0%, rgba(224, 168, 0, 0.9) 100%);
            border-left: 4px solid #d39e00;
            color: var(--dark-gray);
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
            padding: 20px;
        }
        
        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-container {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            max-width: 500px;
            width: 100%;
            overflow: hidden;
            animation: modalSlideIn 0.3s ease;
            border: 1px solid rgba(139, 0, 0, 0.1);
        }
        
        @keyframes modalSlideIn {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Logo Upload Modal */
        .logo-modal .modal-container {
            max-width: 650px;
            width: 90%;
        }
        
        .logo-modal .modal-header {
            background: linear-gradient(135deg, var(--primary-red) 0%, var(--secondary-red) 100%);
            color: var(--gold);
            padding: 30px;
            text-align: center;
            border-bottom: 3px solid var(--gold);
        }
        
        .logo-modal .modal-body {
            padding: 35px;
        }
        
        .upload-area {
            border: 3px dashed var(--primary-red);
            border-radius: var(--border-radius);
            padding: 70px 30px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.03) 0%, rgba(169, 50, 38, 0.01) 100%);
            margin-bottom: 25px;
            min-height: 280px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .upload-area:hover {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.08) 0%, rgba(169, 50, 38, 0.03) 100%);
            border-color: var(--gold);
            transform: translateY(-2px);
        }
        
        .upload-area i {
            font-size: 56px;
            color: var(--primary-red);
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--primary-red) 0%, var(--secondary-red) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .upload-area h4 {
            color: var(--primary-red);
            margin-bottom: 12px;
            font-weight: 700;
            font-size: 18px;
        }
        
        .upload-area p {
            color: var(--medium-gray);
            font-size: 14px;
            font-weight: 400;
            max-width: 400px;
            margin: 0 auto;
        }
        
        #logoPreview {
            display: none;
            max-width: 320px;
            max-height: 320px;
            width: auto;
            height: auto;
            margin: 0 auto 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            object-fit: contain;
            border: 1px solid var(--light-gray);
        }
        
        .logo-preview {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .logo-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }
        
        /* MODAL UPLOAD ẢNH ĐẢNG VIÊN */
        .photo-modal .modal-container {
            max-width: 500px;
            width: 90%;
        }
        
        .photo-modal .modal-header {
            background: linear-gradient(135deg, var(--primary-red) 0%, var(--secondary-red) 100%);
            color: var(--gold);
            padding: 25px 30px;
            text-align: center;
            border-bottom: 3px solid var(--gold);
        }
        
        .photo-modal .modal-body {
            padding: 30px;
        }
        
        .member-photo-preview {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .member-photo-container {
            width: 200px;
            height: 250px;
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 3px solid var(--primary-red);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--light-gray) 0%, #f0f3f7 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .member-photo-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .member-photo-container i {
            font-size: 60px;
            color: var(--medium-gray);
        }
        
        .member-info-preview {
            text-align: center;
            padding: 15px;
            border-radius: var(--border-radius);
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.05) 0%, rgba(169, 50, 38, 0.02) 100%);
            border: 1px solid rgba(139, 0, 0, 0.1);
            min-width: 250px;
        }
        
        .member-info-preview h4 {
            color: var(--primary-red);
            margin-bottom: 8px;
            font-size: 18px;
        }
        
        .member-info-preview p {
            color: var(--medium-gray);
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-red) 0%, var(--secondary-red) 100%);
            color: var(--white);
            padding: 0 35px;
            height: 85px;
            display: flex;
            align-items: center;
            box-shadow: var(--shadow-lg);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            border-bottom: 4px solid var(--gold);
        }
        
        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            cursor: pointer;
            font-size: 24px;
            color: var(--white);
            margin-right: 20px;
        }
        
        .mobile-search-toggle {
            display: none;
            cursor: pointer;
            font-size: 20px;
            color: var(--white);
            margin-right: 15px;
        }
        
        /* Theme Switcher */
        .theme-switcher {
            margin-right: 15px;
            cursor: pointer;
            font-size: 18px;
            color: var(--white);
            padding: 10px;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .theme-switcher:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: rotate(30deg);
        }
        
        /* Notifications */
        .notifications-container {
            position: relative;
            margin-right: 20px;
        }
        
        .notification-bell {
            position: relative;
            cursor: pointer;
            font-size: 20px;
            color: var(--white);
            padding: 10px;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .notification-bell:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .notification-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: var(--white);
            font-size: 11px;
            font-weight: 700;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--primary-red);
        }
        
        .notifications-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            width: 350px;
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-xl);
            display: none;
            z-index: 1001;
            margin-top: 10px;
            border: 1px solid var(--light-gray);
        }
        
        .notifications-dropdown.active {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .notifications-header {
            padding: 20px;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .notifications-header h4 {
            color: var(--primary-red);
            font-weight: 700;
            margin: 0;
        }
        
        .mark-all-read {
            background: none;
            border: none;
            color: var(--info);
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: var(--transition);
        }
        
        .mark-all-read:hover {
            color: var(--primary-red);
        }
        
        .notifications-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .notification-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--light-gray);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }
        
        .notification-item:hover {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.05) 0%, rgba(169, 50, 38, 0.02) 100%);
        }
        
        .notification-item.unread {
            background: rgba(23, 162, 184, 0.05);
        }
        
        .notification-item.unread:hover {
            background: rgba(23, 162, 184, 0.1);
        }
        
        .notification-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-red);
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .notification-icon.success {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }
        
        .notification-icon.warning {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning);
        }
        
        .notification-icon.info {
            background: rgba(23, 162, 184, 0.1);
            color: var(--info);
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 600;
            color: var(--dark-gray);
            margin-bottom: 4px;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .notification-time {
            font-size: 12px;
            color: var(--medium-gray);
        }
        
        .notification-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--info);
            margin-top: 5px;
            flex-shrink: 0;
        }
        
        .notifications-footer {
            padding: 15px 20px;
            text-align: center;
            border-top: 1px solid var(--light-gray);
        }
        
        .notifications-footer a {
            color: var(--primary-red);
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: var(--transition);
        }
        
        .notifications-footer a:hover {
            color: var(--secondary-red);
        }
        
        /* Search Container */
        .search-container {
            flex: 0 1 300px;
            margin: 0 25px;
            position: relative;
        }
        
        .search-box {
            position: relative;
            width: 100%;
        }
        
        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--medium-gray);
            z-index: 1;
        }
        
        #globalSearch {
            width: 100%;
            padding: 12px 15px 12px 45px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.15);
            color: var(--white);
            font-size: 14px;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }
        
        #globalSearch::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        #globalSearch:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.25);
            border-color: var(--gold);
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.2);
        }
        
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-xl);
            margin-top: 5px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 1001;
            border: 1px solid var(--light-gray);
        }
        
        .search-result-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--light-gray);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .search-result-item:hover {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.05) 0%, rgba(169, 50, 38, 0.02) 100%);
        }
        
        .search-result-item:last-child {
            border-bottom: none;
        }
        
        .search-result-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-red);
            font-size: 14px;
        }
        
        .search-result-content {
            flex: 1;
        }
        
        .search-result-title {
            font-weight: 600;
            color: var(--dark-gray);
            margin-bottom: 4px;
            font-size: 14px;
        }
        
        .search-result-subtitle {
            font-size: 12px;
            color: var(--medium-gray);
        }
        
        .search-result-category {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 10px;
            background: var(--light-gray);
            color: var(--medium-gray);
            font-weight: 600;
        }
        
        .logo-area {
            flex: 0 0 85px;
        }
        
        .logo-placeholder {
            width: 150px;
            height: 75px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.1) 100%);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 0px solid var(--red);
            cursor: pointer;
            transition: var(--transition);
            overflow: hidden;
            position: relative;
        }
        
        .logo-placeholder:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0.2) 100%);
            transform: scale(1.08) rotate(5deg);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        .logo-placeholder i {
            font-size: 32px;
            color: var(--gold);
        }
        
        .logo-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: fill;
            padding: 8px;
        }
        
        .logo-placeholder .upload-hint {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.9) 0%, rgba(169, 50, 38, 0.9) 100%);
            color: var(--gold);
            font-size: 11px;
            text-align: center;
            padding: 4px;
            opacity: 0;
            transition: var(--transition);
            font-weight: 500;
            border-top: 1px solid var(--gold);
        }
        
        .logo-placeholder:hover .upload-hint {
            opacity: 1;
        }
        
        .system-name {
            flex: 1;
            text-align: center;
            padding: 0 25px;
        }
        
        .system-name h1 {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 6px;
            letter-spacing: 0.5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            background: linear-gradient(135deg, var(--gold) 0%, #FFD700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .system-name p {
            font-size: 14px;
            opacity: 0.95;
            font-weight: 400;
            color: var(--gold);
        }
        
        .user-area {
            display: flex;
            align-items: center;
            gap: 25px;
        }
        
        .user-info {
            text-align: right;
        }
        
        .user-name {
            font-weight: 700;
            font-size: 17px;
            margin-bottom: 5px;
            color: var(--white);
        }
        
        .user-role {
            font-size: 13px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.1) 100%);
            padding: 5px 14px;
            border-radius: 20px;
            display: inline-block;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .logout-btn {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.15) 100%);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: var(--white);
            padding: 12px 24px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }
        
        .logout-btn:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.25) 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* Main Layout */
        .main-layout {
            display: flex;
            min-height: calc(100vh - 85px);
            margin-top: 85px;
        }
        
        /* Sidebar */
        .sidebar {
            width: 300px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            box-shadow: 3px 0 15px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 85px;
            left: 0;
            bottom: 0;
            overflow-y: auto;
            z-index: 900;
            padding: 30px 0;
            display: none;
            border-right: 3px solid var(--primary-red);
        }
        
        .sidebar.active {
            display: block;
            animation: slideInLeft 0.3s ease;
        }
        
        @keyframes slideInLeft {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        .menu-section {
            margin-bottom: 35px;
            padding: 0 25px;
        }
        
        .menu-title {
            color: var(--primary-red);
            font-weight: 800;
            font-size: 14px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--light-gray);
            display: flex;
            align-items: center;
            gap: 12px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }
        
        .menu-list {
            list-style: none;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            color: var(--dark-gray);
            text-decoration: none;
            border-radius: var(--border-radius);
            margin-bottom: 8px;
            transition: var(--transition);
            gap: 16px;
            cursor: pointer;
            font-weight: 600;
            border: 1px solid transparent;
        }
        
        .menu-item:hover {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.1) 0%, rgba(169, 50, 38, 0.05) 100%);
            color: var(--primary-red);
            transform: translateX(8px);
            border-color: rgba(139, 0, 0, 0.1);
        }
        
        .menu-item.active {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.15) 0%, rgba(169, 50, 38, 0.1) 100%);
            color: var(--primary-red);
            font-weight: 700;
            border-left: 5px solid var(--primary-red);
            box-shadow: var(--shadow-sm);
        }
        
        .menu-item i:first-child {
            width: 24px;
            text-align: center;
            font-size: 20px;
        }
        
        .submenu {
            list-style: none;
            margin-left: 40px;
            margin-top: 8px;
            display: none;
        }
        
        .submenu.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .submenu-item {
            padding: 12px 18px;
            color: var(--medium-gray);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            border-radius: var(--border-radius-sm);
            margin-bottom: 5px;
            transition: var(--transition);
            font-size: 15px;
            font-weight: 500;
            border: 1px solid transparent;
        }
        
        .submenu-item:hover {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.08) 0%, rgba(169, 50, 38, 0.03) 100%);
            color: var(--primary-red);
            padding-left: 22px;
            border-color: rgba(139, 0, 0, 0.1);
        }
        
        .submenu-item.active {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.12) 0%, rgba(169, 50, 38, 0.08) 100%);
            color: var(--primary-red);
            font-weight: 600;
            border-left: 3px solid var(--primary-red);
        }
        
        .submenu-item i {
            font-size: 10px;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 35px;
            margin-left: 0;
            transition: var(--transition);
            display: none;
        }
        
        .main-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .main-content.with-sidebar {
            margin-left: 300px;
        }
        
        /* Page Content */
        .page-content {
            display: none;
        }
        
        .page-content.active {
            display: block;
        }
        
        /* Page Header */
        .page-header {
            margin-bottom: 40px;
            padding-bottom: 25px;
            border-bottom: 2px solid var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .page-header h2 {
            font-size: 32px;
            color: var(--primary-red);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 800;
        }
        
        .page-header p {
            color: var(--medium-gray);
            font-size: 17px;
            font-weight: 400;
            max-width: 800px;
            line-height: 1.6;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--white) 0%, #f8f9fa 100%);
            border-radius: var(--border-radius-lg);
            padding: 32px;
            box-shadow: var(--shadow-lg);
            border-left: 6px solid var(--primary-red);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(139, 0, 0, 0.1);
        }
        
        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.03) 0%, transparent 100%);
            border-radius: 0 0 0 100%;
        }
        
        .stat-number {
            font-size: 48px;
            font-weight: 900;
            color: var(--primary-red);
            margin-bottom: 12px;
            line-height: 1;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .stat-label {
            font-size: 17px;
            color: var(--medium-gray);
            font-weight: 600;
        }
        
        /* Quick Actions */
        .quick-actions {
            background: linear-gradient(135deg, var(--white) 0%, #f8f9fa 100%);
            border-radius: var(--border-radius-lg);
            padding: 35px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 40px;
            border: 1px solid rgba(139, 0, 0, 0.1);
        }
        
        .quick-actions h3 {
            color: var(--primary-red);
            margin-bottom: 30px;
            font-size: 22px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
        }
        
        .action-btn {
            padding: 18px 24px;
            background: linear-gradient(135deg, var(--light-gray) 0%, #f0f3f7 100%);
            border: 1px solid rgba(139, 0, 0, 0.1);
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-weight: 600;
            transition: var(--transition);
            text-align: center;
            color: var(--dark-gray);
            border: none;
            width: 100%;
            font-family: inherit;
        }
        
        .action-btn:hover {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.12) 0%, rgba(169, 50, 38, 0.06) 100%);
            border-color: var(--primary-red);
            color: var(--primary-red);
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        
        .action-btn i {
            font-size: 22px;
        }
        
        /* Recent Activity */
        .recent-activity {
            background: linear-gradient(135deg, var(--white) 0%, #f8f9fa 100%);
            border-radius: var(--border-radius-lg);
            padding: 35px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 40px;
            border: 1px solid rgba(139, 0, 0, 0.1);
        }
        
        .recent-activity h3 {
            color: var(--primary-red);
            margin-bottom: 30px;
            font-size: 22px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 18px;
            padding: 20px;
            border-radius: var(--border-radius);
            background: linear-gradient(135deg, var(--light-gray) 0%, #f0f3f7 100%);
            transition: var(--transition);
            border: 1px solid transparent;
        }
        
        .activity-item:hover {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.08) 0%, rgba(169, 50, 38, 0.04) 100%);
            transform: translateX(8px);
            border-color: rgba(139, 0, 0, 0.1);
        }
        
        .activity-item i {
            font-size: 22px;
            margin-top: 2px;
            flex-shrink: 0;
            padding: 10px;
            border-radius: 50%;
            background: rgba(139, 0, 0, 0.1);
        }
        
        .activity-item .activity-content {
            flex: 1;
        }
        
        .activity-item p {
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 15px;
            line-height: 1.5;
        }
        
        .activity-time {
            font-size: 14px;
            color: var(--medium-gray);
            font-weight: 500;
        }
        
        /* DANH SÁCH ĐẢNG VIÊN VỚI ẢNH */
        .members-list-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid var(--light-gray);
        }
        
        .members-list-container {
            background: linear-gradient(135deg, var(--white) 0%, #f8f9fa 100%);
            border-radius: var(--border-radius-lg);
            border: 1px solid rgba(139, 0, 0, 0.1);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            margin-top: 20px;
        }
        
        .members-list {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .member-item {
            display: grid;
            grid-template-columns: 80px 2fr 1fr 1fr 100px;
            padding: 15px 20px;
            border-bottom: 1px solid var(--light-gray);
            align-items: center;
            transition: var(--transition);
            gap: 15px;
        }
        
        .member-item:hover {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.04) 0%, rgba(169, 50, 38, 0.01) 100%);
        }
        
        .member-item:last-child {
            border-bottom: none;
        }
        
        .member-photo-small {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid var(--primary-red);
            background: linear-gradient(135deg, var(--light-gray) 0%, #f0f3f7 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .member-photo-small:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-md);
        }
        
        .member-photo-small img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .member-photo-small i {
            font-size: 24px;
            color: var(--medium-gray);
        }
        
        .member-info {
            padding: 0 5px;
        }
        
        .member-name {
            font-weight: 700;
            color: var(--primary-red);
            margin-bottom: 5px;
            font-size: 16px;
        }
        
        .member-code {
            font-size: 13px;
            color: var(--medium-gray);
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .member-details {
            font-size: 14px;
            color: var(--dark-gray);
            font-weight: 500;
        }
        
        .member-branch {
            font-size: 14px;
            color: var(--dark-gray);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .member-branch i {
            color: var(--primary-red);
        }
        
        .member-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }
        
        .upload-photo-btn {
            background: var(--info);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 14px;
        }
        
        .upload-photo-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(23, 162, 184, 0.4);
        }
        
        .delete-member-btn {
            background: var(--danger);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 14px;
        }
        
        .delete-member-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }
        
        .no-members {
            text-align: center;
            padding: 60px 30px;
            color: var(--medium-gray);
        }
        
        .no-members i {
            font-size: 56px;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        .no-members p {
            font-size: 16px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .no-members .hint {
            font-size: 14px;
            opacity: 0.7;
            font-weight: 400;
        }
        
        /* Footer */
        .footer {
            background: linear-gradient(135deg, var(--dark-gray) 0%, #253341 100%);
            color: var(--white);
            padding: 25px 35px;
            text-align: center;
            margin-top: auto;
            display: none;
            border-top: 3px solid var(--primary-red);
        }
        
        .footer.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .footer-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            gap: 20px;
        }
        
        .footer-copyright {
            font-size: 15px;
            opacity: 0.9;
            font-weight: 500;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .footer-links {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .footer-links a {
            color: var(--white);
            text-decoration: none;
            opacity: 0.8;
            transition: var(--transition);
            font-size: 15px;
            font-weight: 500;
            padding: 5px 0;
            position: relative;
        }
        
        .footer-links a:hover {
            opacity: 1;
            color: var(--gold);
        }
        
        .footer-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--gold);
            transition: var(--transition);
        }
        
        .footer-links a:hover::after {
            width: 100%;
        }
        
        /* Login Modal */
        .login-modal .modal-container {
            background: linear-gradient(135deg, var(--white) 0%, #f8f9fa 100%);
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-xl);
            max-width: 500px;
            width: 100%;
            overflow: hidden;
            animation: modalSlideIn 0.4s ease;
            border: 1px solid rgba(139, 0, 0, 0.1);
        }
        
        .login-modal .modal-header {
            background: linear-gradient(135deg, var(--primary-red) 0%, var(--secondary-red) 100%);
            color: var(--gold);
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-bottom: 3px solid var(--gold);
        }
        
        .login-modal .modal-header::before {
            content: '';
            position: absolute;
            top: -60px;
            right: -60px;
            width: 180px;
            height: 180px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }
        
        .login-modal .modal-header::after {
            content: '';
            position: absolute;
            bottom: -40px;
            left: -40px;
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
        }
        
        .login-modal .modal-header h3 {
            font-size: 28px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 18px;
            font-weight: 800;
            position: relative;
            z-index: 1;
        }
        
        .login-modal .modal-header p {
            opacity: 0.95;
            font-weight: 500;
            position: relative;
            z-index: 1;
            font-size: 15px;
        }
        
        .login-modal .modal-body {
            padding: 40px;
        }
        
        .form-group {
            margin-bottom: 28px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 12px;
            font-weight: 700;
            color: var(--dark-gray);
            font-size: 16px;
        }
        
        .form-control {
            width: 100%;
            padding: 16px 22px;
            border: 1px solid rgba(139, 0, 0, 0.2);
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
            background: var(--light-gray);
            font-weight: 500;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-red);
            box-shadow: 0 0 0 4px rgba(139, 0, 0, 0.15);
            background: var(--white);
        }
        
        .demo-credentials {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.08) 0%, rgba(169, 50, 38, 0.04) 100%);
            padding: 22px;
            border-radius: var(--border-radius);
            margin-bottom: 32px;
            border-left: 5px solid var(--primary-red);
            border: 1px solid rgba(139, 0, 0, 0.1);
        }
        
        .demo-credentials h5 {
            color: var(--primary-red);
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 17px;
            font-weight: 700;
        }
        
        .credential-item {
            color: var(--medium-gray);
            font-size: 15px;
            margin-bottom: 10px;
            padding-left: 12px;
            font-weight: 500;
            line-height: 1.5;
        }
        
        .credential-item strong {
            color: var(--dark-gray);
            font-weight: 700;
        }
        
        .login-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary-red) 0%, var(--secondary-red) 100%);
            color: var(--white);
            border: none;
            padding: 20px;
            border-radius: var(--border-radius);
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            transition: var(--transition);
            margin-top: 15px;
            border: 1px solid rgba(139, 0, 0, 0.3);
        }
        
        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(139, 0, 0, 0.4);
        }
        
        .login-btn:active {
            transform: translateY(0);
        }
        
        /* Utility Buttons */
        .btn {
            padding: 12px 24px;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            font-weight: 700;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 15px;
            white-space: nowrap;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-red) 0%, var(--secondary-red) 100%);
            color: var(--white);
            border: 1px solid rgba(139, 0, 0, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--secondary-red) 0%, var(--primary-red) 100%);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--medium-gray) 0%, #455a64 100%);
            color: var(--white);
            border: 1px solid rgba(84, 110, 122, 0.3);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #455a64 0%, var(--medium-gray) 100%);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        /* Dark Theme Styles */
        body.dark-theme {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
        }
        
        body.dark-theme .sidebar {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-right: 3px solid var(--gold);
        }
        
        body.dark-theme .main-content {
            background: transparent;
        }
        
        body.dark-theme .stat-card,
        body.dark-theme .quick-actions,
        body.dark-theme .recent-activity,
        body.dark-theme .modal-container,
        body.dark-theme .search-results,
        body.dark-theme .notifications-dropdown,
        body.dark-theme .members-list-container {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-color: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
        }
        
        body.dark-theme .stat-label,
        body.dark-theme .activity-time,
        body.dark-theme .credential-item,
        body.dark-theme .search-result-subtitle,
        body.dark-theme .member-code,
        body.dark-theme .member-details {
            color: #b0b0b0;
        }
        
        body.dark-theme .form-control {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            color: #e0e0e0;
        }
        
        body.dark-theme .form-control:focus {
            background: rgba(255, 255, 255, 0.15);
        }
        
        body.dark-theme .upload-area {
            background: rgba(139, 0, 0, 0.1);
            border-color: var(--gold);
        }
        
        body.dark-theme .menu-item:hover,
        body.dark-theme .submenu-item:hover,
        body.dark-theme .activity-item:hover,
        body.dark-theme .search-result-item:hover,
        body.dark-theme .notification-item:hover,
        body.dark-theme .member-item:hover {
            background: rgba(139, 0, 0, 0.15);
        }
        
        body.dark-theme .footer {
            background: linear-gradient(135deg, #0f3460 0%, #1a1a2e 100%);
        }
        
        body.dark-theme .member-photo-small {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .main-content.with-sidebar {
                margin-left: 300px;
            }
        }
        
        @media (max-width: 992px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .search-container {
                flex: 0 1 250px;
                margin: 0 15px;
            }
            
            .member-item {
                grid-template-columns: 60px 2fr 1fr 100px;
            }
            
            .member-branch {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 0 20px;
                height: 75px;
                justify-content: space-between;
            }
            
            .mobile-menu-toggle {
                display: block;
                order: 2;
            }
            
            .mobile-search-toggle {
                display: flex;
                order: 3;
            }
            
            .logo-area {
                order: 1;
            }
            
            .system-name {
                order: 4;
                flex: 0 0 auto;
                padding: 0 10px;
            }
            
            .theme-switcher {
                order: 5;
                margin-right: 10px;
            }
            
            .notifications-container {
                order: 6;
                margin-right: 10px;
            }
            
            .search-container {
                order: 7;
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: var(--primary-red);
                padding: 15px;
                margin: 0;
                z-index: 999;
            }
            
            .search-container.active {
                display: block;
                animation: slideDown 0.3s ease;
            }
            
            .user-area {
                order: 8;
            }
            
            .system-name h1 {
                font-size: 20px;
            }
            
            .system-name p {
                font-size: 13px;
            }
            
            .logo-placeholder {
                width: 55px;
                height: 55px;
            }
            
            .logo-placeholder i {
                font-size: 26px;
            }
            
            .sidebar {
                width: 100%;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content.with-sidebar {
                margin-left: 0;
            }
            
            .main-content {
                padding: 25px;
            }
            
            .page-header h2 {
                font-size: 28px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .stat-card {
                padding: 28px;
            }
            
            .stat-number {
                font-size: 42px;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .footer {
                padding: 20px 25px;
            }
            
            .footer-links {
                gap: 20px;
            }
            
            .upload-area {
                padding: 50px 20px;
                min-height: 240px;
            }
            
            #logoPreview {
                max-width: 280px;
                max-height: 280px;
            }
            
            .notifications-dropdown {
                width: 300px;
                right: -50px;
            }
            
            .member-item {
                grid-template-columns: 1fr;
                display: block;
                padding: 15px;
            }
            
            .member-photo-small {
                width: 80px;
                height: 80px;
                margin: 0 auto 15px;
            }
            
            .member-info {
                text-align: center;
                margin-bottom: 15px;
            }
            
            .member-actions {
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            .header {
                padding: 0 15px;
                height: 70px;
            }
            
            .system-name h1 {
                font-size: 18px;
            }
            
            .system-name p {
                font-size: 12px;
            }
            
            .user-area {
                gap: 15px;
            }
            
            .logout-btn span {
                display: none;
            }
            
            .logout-btn {
                padding: 12px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .page-header h2 {
                font-size: 24px;
            }
            
            .login-modal .modal-body {
                padding: 30px 20px;
            }
            
            .login-modal .modal-header {
                padding: 30px 20px;
            }
            
            .login-modal .modal-header h3 {
                font-size: 24px;
            }
            
            .logo-modal .modal-body {
                padding: 25px;
            }
            
            .upload-area {
                padding: 40px 15px;
                min-height: 220px;
            }
            
            .upload-area h4 {
                font-size: 17px;
            }
            
            #logoPreview {
                max-width: 240px;
                max-height: 240px;
            }
            
            .footer-links {
                flex-direction: column;
                gap: 12px;
            }
            
            #globalSearch {
                font-size: 13px;
                padding: 10px 15px 10px 40px;
            }
            
            .photo-modal .modal-body {
                padding: 20px;
            }
            
            .member-photo-container {
                width: 180px;
                height: 220px;
            }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="spinner"></div>
        <div style="color: var(--gold); font-weight: 700; font-size: 20px; margin-top: 25px;">Đang tải hệ thống...</div>
    </div>
    
    <!-- Toast Notifications Container -->
    <div id="toast-container"></div>
    
    <!-- LOGO UPLOAD MODAL -->
    <div class="modal-overlay logo-modal" id="logoUploadModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-image"></i> 
                    TẢI LÊN LOGO
                </h3>
                <p>Thay đổi logo hệ thống</p>
            </div>
            <div class="modal-body">
                <div class="upload-area" id="logoUploadArea">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h4>Kéo thả hoặc click để chọn file</h4>
                    <p>Hỗ trợ JPG, PNG, GIF (tối đa 2MB)</p>
                    <input type="file" id="logoFileInput" accept="image/*" style="display: none;">
                </div>
                
                <div class="logo-preview">
                    <img id="logoPreview" alt="Logo preview">
                    <div class="logo-actions">
                        <button class="btn btn-primary" id="saveLogoBtn" style="display: none;">
                            <i class="fas fa-save"></i> Lưu Logo
                        </button>
                        <button class="btn btn-secondary" onclick="closeLogoModal()">
                            <i class="fas fa-times"></i> Hủy
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MODAL UPLOAD ẢNH ĐẢNG VIÊN -->
    <div class="modal-overlay photo-modal" id="memberPhotoModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-camera"></i> 
                    TẢI LÊN ẢNH ĐẢNG VIÊN
                </h3>
                <p id="memberPhotoTitle">Tải lên ảnh cho đảng viên</p>
            </div>
            <div class="modal-body">
                <div class="member-photo-preview">
                    <div class="member-photo-container" id="memberPhotoPreviewContainer">
                        <i class="fas fa-user"></i>
                        <img id="memberPhotoPreview" style="display: none;">
                    </div>
                    
                    <div class="member-info-preview">
                        <h4 id="memberPhotoName">Nguyễn Văn A</h4>
                        <p id="memberPhotoCode">Mã: DV001</p>
                        <p id="memberPhotoBranch">Chi bộ: Văn phòng</p>
                    </div>
                </div>
                
                <div class="upload-area" id="memberPhotoUploadArea">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h4>Kéo thả hoặc click để chọn ảnh</h4>
                    <p>Hỗ trợ JPG, PNG (tỷ lệ 3:4, tối đa 2MB)</p>
                    <input type="file" id="memberPhotoFileInput" accept="image/*" style="display: none;">
                </div>
                
                <div class="logo-actions">
                    <button class="btn btn-primary" id="saveMemberPhotoBtn" style="display: none;">
                        <i class="fas fa-save"></i> Lưu Ảnh
                    </button>
                    <button class="btn btn-secondary" onclick="closeMemberPhotoModal()">
                        <i class="fas fa-times"></i> Hủy
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- HEADER -->
    <header class="header">
        <div class="mobile-menu-toggle" id="mobileMenuToggle">
            <i class="fas fa-bars"></i>
        </div>
        
        <div class="logo-area">
            <div class="logo-placeholder" id="logoContainer" onclick="openLogoUpload()">
                <i class="fas fa-flag" id="defaultLogoIcon"></i>
                <img id="customLogo" style="display: none;">
                <div class="upload-hint">Click để đổi logo</div>
            </div>
        </div>
        
        <div class="mobile-search-toggle" id="mobileSearchToggle">
            <i class="fas fa-search"></i>
        </div>
        
        <div class="system-name">
            <h1>CHƯƠNG TRÌNH QUẢN LÝ CÔNG TÁC ĐẢNG</h1>
            <p>Trung tâm Khai thác Khu bay Nội Bài</p>
        </div>
        
        <div class="theme-switcher" id="themeSwitcher">
            <i class="fas fa-moon" id="themeIcon"></i>
        </div>
        
        <div class="notifications-container" id="notificationsContainer">
            <div class="notification-bell" id="notificationBell">
                <i class="fas fa-bell"></i>
                <span class="notification-count" id="notificationCount">0</span>
            </div>
            <div class="notifications-dropdown" id="notificationsDropdown">
                <div class="notifications-header">
                    <h4>Thông báo</h4>
                    <button class="mark-all-read" id="markAllRead">Đánh dấu đã đọc</button>
                </div>
                <div class="notifications-list" id="notificationsList">
                    <div class="notification-item" style="text-align: center; color: var(--medium-gray);">
                        Đang tải thông báo...
                    </div>
                </div>
                <div class="notifications-footer">
                    <a href="#" onclick="showAllNotifications()">Xem tất cả</a>
                </div>
            </div>
        </div>
        
        <div class="search-container" id="searchContainer">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="globalSearch" placeholder="Tìm kiếm đảng viên, văn bản...">
                <div class="search-results" id="searchResults"></div>
            </div>
        </div>
        
        <div class="user-area">
            <div class="user-info">
                <div class="user-name" id="currentUserName">Vui lòng đăng nhập</div>
                <div class="user-role" id="currentUserRole">Chưa đăng nhập</div>
            </div>
            <button class="logout-btn" id="logoutBtn" style="display: none;">
                <i class="fas fa-sign-out-alt"></i>
                <span>Đăng xuất</span>
            </button>
        </div>
    </header>

    <!-- SIDEBAR -->
    <nav class="sidebar" id="sidebar">
        <div class="menu-section">
            <div class="menu-title">
                <i class="fas fa-bars"></i>
                Menu chính
            </div>
            <ul class="menu-list">
                <li>
                    <a class="menu-item" id="dashboardMenu" onclick="showPage('dashboardContent')">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Bảng điều khiển</span>
                    </a>
                </li>
                <li>
                    <!-- Link sang trang Hồ sơ Đảng viên trong thư mục data -->
                    <a class="menu-item" href="data/Hosodangvien.html" target="_blank">
                        <i class="fas fa-users"></i>
                        <span>Hồ sơ Đảng viên</span>
                        <i class="fas fa-external-link-alt" style="margin-left: auto; font-size: 12px;"></i>
                    </a>
                </li>
                <li>
                    <a class="menu-item" href="data/Quanlyvanban.html" target="_blank">
                        <i class="fas fa-file-alt"></i>
                        <span>Quản lý Văn bản, Nghị quyết</span>
                        <i class="fas fa-external-link-alt" style="margin-left: auto; font-size: 12px;"></i>
                    </a>
                </li>
                <li>
                    <a class="menu-item" href="data/Sinhhoatdang.html" target="_blank">
                        <i class="fas fa-calendar-check"></i>
                        <span>Sinh hoạt Đảng</span>
                        <i class="fas fa-external-link-alt" style="margin-left: auto; font-size: 12px;"></i>
                    </a>
                </li>
                <li>
                    <a class="menu-item" href="Phattriendang.html" target="_blank">
                        <i class="fas fa-chart-line"></i>
                        <span>Công tác Phát triển Đảng</span>
                        <i class="fas fa-external-link-alt" style="margin-left: auto; font-size: 12px;"></i>
                    </a>
                </li>
                <li>
                    <a class="menu-item" href="Baocaothongke.html" target="_blank">
                        <i class="fas fa-chart-bar"></i>
                        <span>Báo cáo Thống kê</span>
                        <i class="fas fa-external-link-alt" style="margin-left: auto; font-size: 12px;"></i>
                    </a>
                </li>
                <li>
                    <a class="menu-item" href="Caidathethong.html" target="_blank">
                        <i class="fas fa-cog"></i>
                        <span>Hệ thống</span>
                        <i class="fas fa-external-link-alt" style="margin-left: auto; font-size: 12px;"></i>
                    </a>
                </li>
            </ul>
        </div>
        
        <div class="menu-section">
            <div class="menu-title">
                <i class="fas fa-history"></i>
                Truy cập nhanh
            </div>
            <ul class="menu-list">
                <li>
                    <!-- Link sang trang Thêm đảng viên mới -->
                    <a class="menu-item" href="Themdangvien.html" target="_blank">
                        <i class="fas fa-plus-circle"></i>
                        <span>Thêm đảng viên mới</span>
                        <i class="fas fa-external-link-alt" style="margin-left: auto; font-size: 12px;"></i>
                    </a>
                </li>
                <li>
                    <a class="menu-item" href="Vanbanchoxuly.html" target="_blank">
                        <i class="fas fa-inbox"></i>
                        <span>Văn bản chờ xử lý</span>
                        <i class="fas fa-external-link-alt" style="margin-left: auto; font-size: 12px;"></i>
                    </a>
                </li>
                <li>
                    <a class="menu-item" href="Thongbao.html" target="_blank">
                        <i class="fas fa-bell"></i>
                        <span>Thông báo mới</span>
                        <i class="fas fa-external-link-alt" style="margin-left: auto; font-size: 12px;"></i>
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="main-content" id="mainContent">
        <!-- Dashboard Content -->
        <div id="dashboardContent" class="page-content active">
            <div class="page-header">
                <div>
                    <h2><i class="fas fa-tachometer-alt"></i> Bảng điều khiển</h2>
                    <p>Tổng quan hệ thống và thống kê công tác đảng</p>
                </div>
                <button class="btn btn-primary" onclick="exportDashboardReport()">
                    <i class="fas fa-download"></i> Xuất báo cáo
                </button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalMembers">156</div>
                    <div class="stat-label">Tổng số đảng viên</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalDocuments">42</div>
                    <div class="stat-label">Văn bản đã xử lý</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalMeetings">8</div>
                    <div class="stat-label">Sinh hoạt tháng này</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="newMembers">3</div>
                    <div class="stat-label">Đảng viên mới</div>
                </div>
            </div>
            
            <div class="quick-actions">
                <h3><i class="fas fa-bolt"></i> Thao tác nhanh</h3>
                <div class="action-buttons">
                    <!-- Link sang trang Hồ sơ Đảng viên trong thư mục data -->
                    <a href="data/Hosodangvien.html" target="_blank" style="text-decoration: none;">
                        <button class="action-btn">
                        <i class="fas fa-user-plus"></i>
                        Quản lý đảng viên
                        </button>
                    </a>
                    <!-- Link sang trang Nhập dữ liệu -->
                    <a href="Nhapdulieu.html" target="_blank" style="text-decoration: none;">
                        <button class="action-btn">
                            <i class="fas fa-file-import"></i>
                            Nhập dữ liệu
                        </button>
                    </a>
                    <!-- Link sang trang Xuất báo cáo -->
                    <a href="Xuatbaocao.html" target="_blank" style="text-decoration: none;">
                        <button class="action-btn">
                            <i class="fas fa-file-export"></i>
                            Xuất báo cáo
                        </button>
                    </a>
                    <!-- Link sang trang Cài đặt hệ thống -->
                    <a href="Caidathethong.html" target="_blank" style="text-decoration: none;">
                        <button class="action-btn">
                            <i class="fas fa-cog"></i>
                            Cài đặt hệ thống
                        </button>
                    </a>
                    <!-- Thêm 2 nút quản lý đảng viên -->
                    <button class="action-btn" onclick="addNewMember()">
                        <i class="fas fa-user-plus"></i>
                        Thêm đảng viên
                    </button>
                    <button class="action-btn" onclick="loadMembersListWithPhotos()">
                        <i class="fas fa-images"></i>
                        Xem ảnh đảng viên
                    </button>
                </div>
            </div>
            
            <!-- DANH SÁCH ĐẢNG VIÊN VỚI ẢNH -->
            <div class="members-list-section">
                <div class="section-header">
                    <h4>
                        <i class="fas fa-users"></i> 
                        DANH SÁCH ĐẢNG VIÊN VỚI ẢNH
                    </h4>
                    <div class="total-members-badge">
                        <i class="fas fa-user-friends"></i>
                        <span id="membersCount">0</span> đảng viên
                    </div>
                </div>
                
                <div class="members-list-container">
                    <div class="members-list" id="membersList">
                        <!-- Danh sách đảng viên với ảnh sẽ được tải ở đây -->
                    </div>
                </div>
            </div>
            
            <div class="recent-activity">
                <h3><i class="fas fa-history"></i> Hoạt động gần đây</h3>
                <div class="activity-list">
                    <div class="activity-item">
                        <i class="fas fa-user-check" style="color: var(--success);"></i>
                        <div class="activity-content">
                            <p>Nguyễn Văn C đã được thêm vào hệ thống</p>
                            <div class="activity-time">10 phút trước</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <i class="fas fa-file-signature" style="color: var(--info);"></i>
                        <div class="activity-content">
                            <p>Nghị quyết tháng 12 đã được cập nhật</p>
                            <div class="activity-time">1 giờ trước</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <i class="fas fa-calendar-alt" style="color: var(--warning);"></i>
                        <div class="activity-content">
                            <p>Đã lên lịch sinh hoạt chi bộ tháng 1</p>
                            <div class="activity-time">2 giờ trước</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <i class="fas fa-chart-line" style="color: var(--primary-red);"></i>
                        <div class="activity-content">
                            <p>Báo cáo thống kê quý IV đã hoàn thành</p>
                            <div class="activity-time">5 giờ trước</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="footer" id="footer">
        <div class="footer-content">
            <div class="footer-copyright">
                © 2026 Chương trình Quản lý Công tác Đảng - Phiên bản 1.0
            </div>
            <div class="footer-links">
                <!-- Link thực sự cho các trang footer -->
                <a href="mailto:naoc.cns@gmail.com">Trợ giúp: naoc.cns@gmail.com</a>
                <a href="Huongdansudung.html" target="_blank">Hướng dẫn sử dụng</a>
                <a href="tel:0919926586">Liên hệ: 0919926586</a>
                <a href="Banquyen.html" target="_blank">Bản quyền thuộc Đội Thiết bị Thông tin dẫn đường</a>
            </div>
        </div>
    </footer>

    <!-- LOGIN MODAL -->
    <div class="modal-overlay login-modal active" id="loginModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-sign-in-alt"></i> 
                    ĐĂNG NHẬP HỆ THỐNG
                </h3>
                <p>Chương trình Quản lý Công tác Đảng</p>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginUsername">Tên đăng nhập</label>
                        <input type="text" 
                               id="loginUsername" 
                               class="form-control" 
                               required 
                               placeholder="Nhập tên đăng nhập"
                               value="admin">
                    </div>
                    
                    <div class="form-group">
                        <label for="loginPassword">Mật khẩu</label>
                        <input type="password" 
                               id="loginPassword" 
                               class="form-control" 
                               required 
                               placeholder="Nhập mật khẩu"
                               value="admin123">
                    </div>
                    
                    <div class="demo-credentials">
                        <h5>
                            <i class="fas fa-info-circle"></i> 
                            Tài khoản demo
                        </h5>
                        <div class="credential-item">
                            <strong>Quản trị viên:</strong> admin / admin123
                        </div>
                        <div class="credential-item">
                            <strong>Bí thư chi bộ:</strong> bithu_VP / bithu123
                        </div>
                        <div class="credential-item">
                            <strong>Cán bộ:</strong> canbo / canbo123
                        </div>
                    </div>
                    
                    <button type="submit" class="login-btn" id="loginSubmitBtn">
                        <i class="fas fa-sign-in-alt"></i>
                        Đăng nhập
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // ====== BIẾN TOÀN CỤC ======
        let isLoggedIn = false;
        let currentUser = null;
        let selectedLogoFile = null;
        let selectedMemberPhotoFile = null;
        let currentEditingMemberId = null;
        
        // Danh sách đảng viên (lấy từ localStorage hoặc mặc định)
        let partyMembers = JSON.parse(localStorage.getItem('partyMembers')) || [
            { 
                id: 1, 
                name: "Nguyễn Văn A", 
                code: "DV001", 
                branch: "Chi bộ Văn phòng",
                position: "Bí thư",
                photo: null
            },
            { 
                id: 2, 
                name: "Trần Thị B", 
                code: "DV002", 
                branch: "Chi bộ Kỹ thuật",
                position: "Phó Bí thư",
                photo: null
            },
            { 
                id: 3, 
                name: "Lê Văn C", 
                code: "DV003", 
                branch: "Chi bộ Hành chính",
                position: "Đảng viên",
                photo: null
            }
        ];
        
        let notifications = [
            {
                id: 1,
                title: "Họp chi bộ tháng 1",
                message: "Cuộc họp chi bộ tháng 1 sẽ diễn ra vào 15/01/2025",
                time: "10 phút trước",
                type: "meeting",
                icon: "calendar-check",
                read: false,
                color: "info"
            },
            {
                id: 2,
                title: "Đảng viên mới",
                message: "Nguyễn Văn C đã được kết nạp vào Đảng",
                time: "1 giờ trước",
                type: "member",
                icon: "user-plus",
                read: false,
                color: "success"
            },
            {
                id: 3,
                title: "Văn bản chờ xử lý",
                message: "Có 3 văn bản mới cần được xử lý",
                time: "3 giờ trước",
                type: "document",
                icon: "file-alt",
                read: false,
                color: "warning"
            }
        ];
        
        // ====== HÀM HIỂN THỊ TOAST ======
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            const icons = {
                'success': 'check-circle',
                'error': 'exclamation-circle',
                'warning': 'exclamation-triangle',
                'info': 'info-circle'
            };
            
            toast.innerHTML = `
                <i class="fas fa-${icons[type]}"></i>
                <span>${message}</span>
            `;
            
            toastContainer.appendChild(toast);
            
            // Tự động xóa sau 4 giây
            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toastContainer.removeChild(toast);
                    }
                }, 300);
            }, 4000);
        }
        
        // ====== HÀM THÊM ĐẢNG VIÊN MỚI ======
        function addNewMember() {
            if (!isLoggedIn) {
                showToast('Vui lòng đăng nhập để thêm đảng viên!', 'warning');
                return;
            }
            
            // Tạo tên đảng viên ngẫu nhiên
            const names = ["Nguyễn Văn D", "Trần Thị E", "Lê Văn F", "Phạm Thị G", "Hoàng Văn H"];
            const branches = ["Chi bộ Văn phòng", "Chi bộ Kỹ thuật", "Chi bộ Hành chính", "Chi bộ Kế toán"];
            const positions = ["Đảng viên", "Phó Bí thư", "Ủy viên", "Thường vụ"];
            
            const newName = names[Math.floor(Math.random() * names.length)];
            const newCode = `DV${String(partyMembers.length + 1).padStart(3, '0')}`;
            const newBranch = branches[Math.floor(Math.random() * branches.length)];
            const newPosition = positions[Math.floor(Math.random() * positions.length)];
            
            const newMember = {
                id: partyMembers.length + 1,
                name: newName,
                code: newCode,
                branch: newBranch,
                position: newPosition,
                photo: null
            };
            
            // Thêm vào danh sách
            partyMembers.push(newMember);
            
            // Lưu vào localStorage
            localStorage.setItem('partyMembers', JSON.stringify(partyMembers));
            
            // Cập nhật thống kê
            updateDashboardStats();
            
            // Tải lại danh sách đảng viên
            loadMembersListWithPhotos();
            
            // Thêm hoạt động gần đây
            addRecentActivity(`Đã thêm đảng viên mới: ${newName} (${newCode}) - ${newBranch}`);
            
            // Tạo thông báo
            addNotification({
                title: "Đảng viên mới",
                message: `${newName} đã được thêm vào ${newBranch}`,
                type: "member",
                icon: "user-plus",
                color: "success"
            });
            
            showToast(`Đã thêm đảng viên ${newName} thành công!`, 'success');
        }
        
        // ====== HÀM XÓA ĐẢNG VIÊN ======
        function deleteMember(memberId) {
            if (!isLoggedIn) {
                showToast('Vui lòng đăng nhập để xóa đảng viên!', 'warning');
                return;
            }
            
            if (partyMembers.length === 0) {
                showToast('Không có đảng viên nào để xóa!', 'warning');
                return;
            }
            
            const member = partyMembers.find(m => m.id === memberId);
            if (!member) return;
            
            if (!confirm(`Bạn có chắc chắn muốn xóa đảng viên:\n${member.name} (${member.code})?\n\nHành động này không thể hoàn tả!`)) {
                return;
            }
            
            // Xóa khỏi mảng
            const memberIndex = partyMembers.findIndex(m => m.id === memberId);
            const removedMember = partyMembers[memberIndex];
            partyMembers.splice(memberIndex, 1);
            
            // Lưu vào localStorage
            localStorage.setItem('partyMembers', JSON.stringify(partyMembers));
            
            // Cập nhật thống kê
            updateDashboardStats();
            
            // Tải lại danh sách đảng viên
            loadMembersListWithPhotos();
            
            // Thêm hoạt động gần đây
            addRecentActivity(`Đã xóa đảng viên: ${removedMember.name} (${removedMember.code})`);
            
            showToast(`Đã xóa đảng viên ${removedMember.name}`, 'info');
        }
        
        // ====== HÀM MỞ MODAL UPLOAD ẢNH ĐẢNG VIÊN ======
        function openMemberPhotoModal(memberId) {
            if (!isLoggedIn) {
                showToast('Vui lòng đăng nhập để upload ảnh!', 'warning');
                return;
            }
            
            const member = partyMembers.find(m => m.id === memberId);
            if (!member) {
                showToast('Không tìm thấy đảng viên!', 'error');
                return;
            }
            
            currentEditingMemberId = memberId;
            
            // Cập nhật thông tin trong modal
            document.getElementById('memberPhotoTitle').textContent = `Tải lên ảnh cho ${member.name}`;
            document.getElementById('memberPhotoName').textContent = member.name;
            document.getElementById('memberPhotoCode').textContent = `Mã: ${member.code}`;
            document.getElementById('memberPhotoBranch').textContent = `Chi bộ: ${member.branch}`;
            
            // Hiển thị ảnh hiện tại nếu có
            const photoPreview = document.getElementById('memberPhotoPreview');
            const photoPreviewContainer = document.getElementById('memberPhotoPreviewContainer');
            
            if (member.photo) {
                photoPreview.src = member.photo;
                photoPreview.style.display = 'block';
                photoPreviewContainer.querySelector('i').style.display = 'none';
            } else {
                photoPreview.style.display = 'none';
                photoPreviewContainer.querySelector('i').style.display = 'block';
            }
            
            // Reset file input
            document.getElementById('memberPhotoFileInput').value = '';
            document.getElementById('saveMemberPhotoBtn').style.display = 'none';
            selectedMemberPhotoFile = null;
            
            // Hiển thị modal
            const photoModal = document.getElementById('memberPhotoModal');
            photoModal.classList.add('active');
        }
        
        // ====== HÀM ĐÓNG MODAL UPLOAD ẢNH ======
        function closeMemberPhotoModal() {
            const photoModal = document.getElementById('memberPhotoModal');
            photoModal.classList.remove('active');
            currentEditingMemberId = null;
            selectedMemberPhotoFile = null;
        }
        
        // ====== HÀM LƯU ẢNH ĐẢNG VIÊN ======
        function saveMemberPhoto() {
            if (!selectedMemberPhotoFile || !currentEditingMemberId) {
                showToast('Vui lòng chọn ảnh trước khi lưu!', 'warning');
                return;
            }
            
            // Hiển thị loading
            const loadingOverlay = document.getElementById('loading-overlay');
            loadingOverlay.classList.add('active');
            
            // Giả lập upload
            setTimeout(() => {
                loadingOverlay.classList.remove('active');
                
                // Tìm đảng viên
                const memberIndex = partyMembers.findIndex(m => m.id === currentEditingMemberId);
                if (memberIndex === -1) {
                    showToast('Không tìm thấy đảng viên!', 'error');
                    return;
                }
                
                // Chuyển ảnh sang base64
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Lưu ảnh vào đảng viên
                    partyMembers[memberIndex].photo = e.target.result;
                    
                    // Lưu vào localStorage
                    localStorage.setItem('partyMembers', JSON.stringify(partyMembers));
                    
                    // Tải lại danh sách
                    loadMembersListWithPhotos();
                    
                    // Đóng modal
                    closeMemberPhotoModal();
                    
                    // Thêm hoạt động
                    addRecentActivity(`Đã cập nhật ảnh cho đảng viên: ${partyMembers[memberIndex].name}`);
                    
                    showToast(`Đã cập nhật ảnh thành công cho ${partyMembers[memberIndex].name}!`, 'success');
                };
                reader.readAsDataURL(selectedMemberPhotoFile);
            }, 1500);
        }
        
        // ====== TẢI DANH SÁCH ĐẢNG VIÊN VỚI ẢNH ======
        function loadMembersListWithPhotos() {
            const membersList = document.getElementById('membersList');
            const membersCount = document.getElementById('membersCount');
            
            if (!membersList) return;
            
            // Cập nhật số lượng
            if (membersCount) {
                membersCount.textContent = partyMembers.length;
            }
            
            if (partyMembers.length === 0) {
                membersList.innerHTML = `
                    <div class="no-members">
                        <i class="fas fa-users"></i>
                        <p>Chưa có đảng viên nào trong hệ thống</p>
                        <p class="hint">Hãy thêm đảng viên đầu tiên bằng nút "Thêm đảng viên"</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            partyMembers.forEach(member => {
                html += `
                    <div class="member-item">
                        <div class="member-photo-small" onclick="openMemberPhotoModal(${member.id})">
                            ${member.photo ? 
                                `<img src="${member.photo}" alt="${member.name}" title="Click để đổi ảnh">` : 
                                `<i class="fas fa-user" title="Chưa có ảnh - Click để upload"></i>`
                            }
                        </div>
                        <div class="member-info">
                            <div class="member-name">${member.name}</div>
                            <div class="member-code">${member.code}</div>
                            <div class="member-details">${member.position}</div>
                        </div>
                        <div class="member-branch">
                            <i class="fas fa-building"></i>
                            ${member.branch}
                        </div>
                        <div class="member-actions">
                            <button class="upload-photo-btn" onclick="openMemberPhotoModal(${member.id})" 
                                    title="Upload ảnh đảng viên">
                                <i class="fas fa-camera"></i>
                            </button>
                            <button class="delete-member-btn" onclick="deleteMember(${member.id})" 
                                    title="Xóa đảng viên">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            membersList.innerHTML = html;
        }
        
        // ====== THÊM HOẠT ĐỘNG GẦN ĐÂY ======
        function addRecentActivity(activityText) {
            const activityList = document.querySelector('.activity-list');
            if (!activityList) return;
            
            const activityItem = document.createElement('div');
            activityItem.className = 'activity-item';
            activityItem.innerHTML = `
                <i class="fas fa-user-plus" style="color: var(--success);"></i>
                <div class="activity-content">
                    <p>${activityText}</p>
                    <div class="activity-time">Vừa xong</div>
                </div>
            `;
            
            // Thêm vào đầu danh sách
            activityList.insertBefore(activityItem, activityList.firstChild);
            
            // Giới hạn số lượng hoạt động
            const maxActivities = 4;
            if (activityList.children.length > maxActivities) {
                activityList.removeChild(activityList.lastChild);
            }
        }
        
        // ====== THÊM THÔNG BÁO MỚI ======
        function addNotification(notificationData) {
            const newNotification = {
                id: notifications.length + 1,
                title: notificationData.title,
                message: notificationData.message,
                time: 'Vừa xong',
                type: notificationData.type,
                icon: notificationData.icon,
                read: false,
                color: notificationData.color
            };
            
            notifications.unshift(newNotification);
            updateNotificationCount();
        }
        
        // ====== HÀM TOGGLE SUBMENU ======
        function toggleSubmenu(submenuId) {
            const submenu = document.getElementById(submenuId);
            submenu.classList.toggle('active');
        }
        
        // ====== HÀM HIỂN THỊ TRANG ======
        function showPage(pageId) {
            // Ẩn tất cả các trang
            const pages = document.querySelectorAll('.page-content');
            pages.forEach(page => {
                page.classList.remove('active');
            });
            
            // Hiển thị trang được chọn
            const activePage = document.getElementById(pageId);
            if (activePage) {
                activePage.classList.add('active');
                
                // Cập nhật menu active
                const menuItems = document.querySelectorAll('.menu-item');
                menuItems.forEach(item => {
                    item.classList.remove('active');
                });
                
                const activeMenuItem = document.querySelector(`[onclick*="${pageId}"]`);
                if (activeMenuItem) {
                    activeMenuItem.classList.add('active');
                }
            }
        }
        
        // ====== LOGO UPLOAD FUNCTIONS ======
        
        // Mở modal upload logo
        function openLogoUpload() {
            if (!isLoggedIn) {
                showToast('Vui lòng đăng nhập để thay đổi logo!', 'warning');
                return;
            }
            
            const logoModal = document.getElementById('logoUploadModal');
            logoModal.classList.add('active');
            
            // Reset preview
            document.getElementById('logoPreview').style.display = 'none';
            document.getElementById('saveLogoBtn').style.display = 'none';
            selectedLogoFile = null;
        }
        
        // Đóng modal upload logo
        function closeLogoModal() {
            const logoModal = document.getElementById('logoUploadModal');
            logoModal.classList.remove('active');
            
            // Reset file input
            document.getElementById('logoFileInput').value = '';
        }
        
        // Lưu logo đã upload
        function saveLogo() {
            if (!selectedLogoFile) {
                showToast('Vui lòng chọn file ảnh trước!', 'warning');
                return;
            }
            
            // Hiển thị loading
            const loadingOverlay = document.getElementById('loading-overlay');
            loadingOverlay.classList.add('active');
            
            // Giả lập upload (trong thực tế sẽ gửi lên server)
            setTimeout(() => {
                loadingOverlay.classList.remove('active');
                
                // Lưu logo vào localStorage
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Lưu vào localStorage
                    localStorage.setItem('partySystemLogo', e.target.result);
                    
                    // Cập nhật logo hiển thị
                    updateLogoDisplay(e.target.result);
                    
                    // Đóng modal
                    closeLogoModal();
                    
                    showToast('Đã cập nhật logo thành công!', 'success');
                };
                reader.readAsDataURL(selectedLogoFile);
            }, 1500);
        }
        
        // Cập nhật logo hiển thị
        function updateLogoDisplay(logoData) {
            const defaultIcon = document.getElementById('defaultLogoIcon');
            const customLogo = document.getElementById('customLogo');
            
            if (logoData) {
                defaultIcon.style.display = 'none';
                customLogo.src = logoData;
                customLogo.style.display = 'block';
            } else {
                defaultIcon.style.display = 'block';
                customLogo.style.display = 'none';
            }
        }
        
        // ====== THÔNG BÁO FUNCTIONS ======
        
        // Cập nhật số lượng thông báo
        function updateNotificationCount() {
            const unreadCount = notifications.filter(n => !n.read).length;
            const notificationCount = document.getElementById('notificationCount');
            if (notificationCount) {
                notificationCount.textContent = unreadCount;
                
                if (unreadCount > 0) {
                    const notificationBell = document.getElementById('notificationBell');
                    if (notificationBell) {
                        notificationBell.style.animation = 'pulse 1.5s infinite';
                    }
                } else {
                    const notificationBell = document.getElementById('notificationBell');
                    if (notificationBell) {
                        notificationBell.style.animation = 'none';
                    }
                }
            }
        }
        
        // Hiển thị danh sách thông báo
        function renderNotifications() {
            const notificationsList = document.getElementById('notificationsList');
            if (!notificationsList) return;
            
            notificationsList.innerHTML = '';
            
            if (notifications.length === 0) {
                notificationsList.innerHTML = `
                    <div class="notification-item" style="text-align: center; color: var(--medium-gray);">
                        Không có thông báo mới
                    </div>
                `;
                return;
            }
            
            notifications.forEach(notification => {
                const notificationItem = document.createElement('div');
                notificationItem.className = `notification-item ${notification.read ? '' : 'unread'}`;
                notificationItem.dataset.id = notification.id;
                
                notificationItem.innerHTML = `
                    <div class="notification-icon ${notification.color}">
                        <i class="fas fa-${notification.icon}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${notification.title}</div>
                        <div class="notification-message">${notification.message}</div>
                        <div class="notification-time">${notification.time}</div>
                    </div>
                    ${!notification.read ? '<div class="notification-dot"></div>' : ''}
                `;
                
                notificationItem.addEventListener('click', function() {
                    markAsRead(notification.id);
                    showToast(`Đã mở thông báo: ${notification.title}`, 'info');
                });
                
                notificationsList.appendChild(notificationItem);
            });
        }
        
        // Đánh dấu đã đọc
        function markAsRead(id) {
            const notification = notifications.find(n => n.id === id);
            if (notification) {
                notification.read = true;
                updateNotificationCount();
                renderNotifications();
            }
        }
        
        // Simulate new notifications
        function simulateNewNotification() {
            if (!isLoggedIn) return;
            
            const types = [
                { type: 'meeting', icon: 'calendar-alt', color: 'info' },
                { type: 'document', icon: 'file-signature', color: 'warning' },
                { type: 'member', icon: 'user-check', color: 'success' },
                { type: 'report', icon: 'chart-line', color: 'primary' }
            ];
            
            const type = types[Math.floor(Math.random() * types.length)];
            const titles = [
                "Nhắc lịch sinh hoạt",
                "Văn bản mới cần duyệt",
                "Báo cáo thống kê đã sẵn sàng",
                "Cập nhật thông tin đảng viên"
            ];
            
            const messages = [
                "Có cuộc họp sắp diễn ra vào tuần tới",
                "Vui lòng xem xét và phê duyệt văn bản",
                "Báo cáo đã được hệ thống tổng hợp",
                "Thông tin đảng viên cần được cập nhật"
            ];
            
            const newNotification = {
                id: notifications.length + 1,
                title: titles[Math.floor(Math.random() * titles.length)],
                message: messages[Math.floor(Math.random() * messages.length)],
                time: 'Vừa xong',
                type: type.type,
                icon: type.icon,
                read: false,
                color: type.color
            };
            
            notifications.unshift(newNotification);
            updateNotificationCount();
            
            // Hiển thị toast thông báo mới
            const notificationsDropdown = document.getElementById('notificationsDropdown');
            if (notificationsDropdown && notificationsDropdown.classList.contains('active')) {
                renderNotifications();
            } else {
                showToast(`Thông báo mới: ${newNotification.title}`, 'info');
            }
        }
        
        // ====== TÌM KIẾM FUNCTIONS ======
        
        // Dữ liệu tìm kiếm mẫu
        const searchData = [
            { 
                id: 1, 
                title: "Nguyễn Văn A", 
                subtitle: "Đảng viên - Chi bộ Văn phòng", 
                category: "Đảng viên",
                icon: "user",
                action: "showMemberDetail(1)"
            },
            { 
                id: 2, 
                title: "Nghị quyết tháng 12/2024", 
                subtitle: "Về công tác phát triển đảng", 
                category: "Văn bản",
                icon: "file-alt",
                action: "showDocumentDetail(2)"
            },
            { 
                id: 3, 
                title: "Sinh hoạt chi bộ tháng 1", 
                subtitle: "15/01/2025 - Phòng họp 301", 
                category: "Sinh hoạt",
                icon: "calendar-check",
                action: "showMeetingDetail(3)"
            },
            { 
                id: 4, 
                title: "Báo cáo thống kê quý IV", 
                subtitle: "Đã hoàn thành - Chờ duyệt", 
                category: "Báo cáo",
                icon: "chart-bar",
                action: "showReportDetail(4)"
            }
        ];
        
        // ====== THEME FUNCTIONS ======
        
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            
            const themeIcon = document.getElementById('themeIcon');
            if (document.body.classList.contains('dark-theme')) {
                themeIcon.className = 'fas fa-sun';
                localStorage.setItem('partySystemTheme', 'dark');
                showToast('Đã chuyển sang chế độ tối', 'success');
            } else {
                themeIcon.className = 'fas fa-moon';
                localStorage.setItem('partySystemTheme', 'light');
                showToast('Đã chuyển sang chế độ sáng', 'success');
            }
        }
        
        // ====== DASHBOARD STATS FUNCTIONS ======
        
        function updateDashboardStats() {
            if (!isLoggedIn) return;
            
            // Sử dụng số lượng đảng viên thực tế
            const stats = {
                totalMembers: partyMembers.length,
                totalDocuments: Math.floor(Math.random() * 5) + 40,
                totalMeetings: Math.floor(Math.random() * 3) + 8,
                newMembers: Math.floor(Math.random() * 2) + 3
            };
            
            // Cập nhật với animation
            const statElements = {
                totalMembers: document.getElementById('totalMembers'),
                totalDocuments: document.getElementById('totalDocuments'),
                totalMeetings: document.getElementById('totalMeetings'),
                newMembers: document.getElementById('newMembers')
            };
            
            for (const [key, element] of Object.entries(statElements)) {
                if (element) {
                    const currentValue = parseInt(element.textContent);
                    const newValue = stats[key];
                    
                    if (currentValue !== newValue) {
                        // Animation count up
                        animateCount(element, currentValue, newValue);
                    }
                }
            }
        }
        
        function animateCount(element, start, end) {
            const duration = 1000;
            const startTime = Date.now();
            
            function update() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const current = Math.floor(start + (end - start) * easeOutQuart);
                
                element.textContent = current;
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                } else {
                    element.textContent = end;
                }
            }
            
            requestAnimationFrame(update);
        }
        
        // ====== EXPORT REPORT FUNCTION ======
        
        function exportDashboardReport() {
            if (!isLoggedIn) {
                showToast('Vui lòng đăng nhập để xuất báo cáo', 'warning');
                return;
            }
            
            const loadingOverlay = document.getElementById('loading-overlay');
            loadingOverlay.classList.add('active');
            
            // Giả lập tạo báo cáo
            setTimeout(() => {
                loadingOverlay.classList.remove('active');
                
                // Tạo nội dung báo cáo với số lượng thực tế
                const reportContent = `
BÁO CÁO TỔNG QUAN HỆ THỐNG
Ngày: ${new Date().toLocaleDateString('vi-VN')}

Tổng số đảng viên: ${partyMembers.length}
Văn bản đã xử lý: ${document.getElementById('totalDocuments').textContent}
Sinh hoạt tháng này: ${document.getElementById('totalMeetings').textContent}
Đảng viên mới: ${document.getElementById('newMembers').textContent}

DANH SÁCH ĐẢNG VIÊN:
${partyMembers.map((member, index) => `${index + 1}. ${member.name} - ${member.code} - ${member.branch}`).join('\n')}

Tổng cộng: ${partyMembers.length} đảng viên

Người xuất báo cáo: ${currentUser ? currentUser.name : 'Unknown'}
Vai trò: ${currentUser ? currentUser.role : 'Unknown'}

--- Kết thúc báo cáo ---
                `;
                
                // Tạo và tải file
                const blob = new Blob([reportContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `baocao_dangvien_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('Đã xuất báo cáo thành công!', 'success');
            }, 1500);
        }
        
        // ====== RESPONSIVE HANDLING ======
        
        function handleResponsive() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const searchContainer = document.getElementById('searchContainer');
            
            if (window.innerWidth <= 768) {
                if (mainContent) mainContent.classList.remove('with-sidebar');
                
                // Ẩn sidebar mặc định
                if (sidebar) sidebar.classList.remove('active');
                
                // Đổi icon menu toggle
                const menuToggleIcon = document.querySelector('#mobileMenuToggle i');
                if (menuToggleIcon) {
                    menuToggleIcon.className = 'fas fa-bars';
                }
            } else {
                if (isLoggedIn && sidebar) {
                    sidebar.classList.add('active');
                    if (mainContent) mainContent.classList.add('with-sidebar');
                }
            }
        }
        
        // ====== GLOBAL FUNCTIONS ======
        
        window.showAllNotifications = function() {
            showToast('Chuyển đến trang thông báo đầy đủ', 'info');
            // Trong thực tế sẽ điều hướng đến trang thông báo
        };
        
        // ====== KHỞI TẠO KHI DOM LOADED ======
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Hệ thống đang khởi tạo...');
            
            // DOM Elements
            const loginForm = document.getElementById('loginForm');
            const loginModal = document.getElementById('loginModal');
            const loadingOverlay = document.getElementById('loading-overlay');
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const footer = document.getElementById('footer');
            const logoutBtn = document.getElementById('logoutBtn');
            const currentUserName = document.getElementById('currentUserName');
            const currentUserRole = document.getElementById('currentUserRole');
            
            // ====== LOGO UPLOAD HANDLERS ======
            
            // Tải logo từ localStorage nếu có
            const savedLogo = localStorage.getItem('partySystemLogo');
            if (savedLogo) {
                updateLogoDisplay(savedLogo);
            }
            
            // Setup logo upload area
            const logoUploadArea = document.getElementById('logoUploadArea');
            const logoFileInput = document.getElementById('logoFileInput');
            const logoPreview = document.getElementById('logoPreview');
            const saveLogoBtn = document.getElementById('saveLogoBtn');
            
            // Click vào area để mở file dialog
            logoUploadArea.addEventListener('click', function() {
                logoFileInput.click();
            });
            
            // Kéo thả file vào area
            logoUploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                logoUploadArea.style.background = 'rgba(139, 0, 0, 0.1)';
                logoUploadArea.style.borderColor = 'var(--secondary-red)';
            });
            
            logoUploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                logoUploadArea.style.background = 'rgba(139, 0, 0, 0.02)';
                logoUploadArea.style.borderColor = 'var(--primary-red)';
            });
            
            logoUploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                logoUploadArea.style.background = 'rgba(139, 0, 0, 0.02)';
                logoUploadArea.style.borderColor = 'var(--primary-red)';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleLogoFile(files[0]);
                }
            });
            
            // Xử lý chọn file
            logoFileInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    handleLogoFile(e.target.files[0]);
                }
            });
            
            // Hàm xử lý file logo
            function handleLogoFile(file) {
                // Kiểm tra file type
                if (!file.type.match('image.*')) {
                    showToast('Vui lòng chọn file ảnh!', 'error');
                    return;
                }
                
                // Kiểm tra kích thước file (max 2MB)
                if (file.size > 2 * 1024 * 1024) {
                    showToast('File ảnh quá lớn! Vui lòng chọn file nhỏ hơn 2MB.', 'error');
                    return;
                }
                
                selectedLogoFile = file;
                
                // Hiển thị preview
                const reader = new FileReader();
                reader.onload = function(e) {
                    logoPreview.src = e.target.result;
                    logoPreview.style.display = 'block';
                    saveLogoBtn.style.display = 'inline-flex';
                };
                reader.readAsDataURL(file);
                
                showToast(`Đã chọn file: ${file.name}`, 'info');
            }
            
            // Xử lý nút lưu logo
            saveLogoBtn.addEventListener('click', saveLogo);
            
            // ====== MEMBER PHOTO UPLOAD HANDLERS ======
            
            // Setup member photo upload area
            const memberPhotoUploadArea = document.getElementById('memberPhotoUploadArea');
            const memberPhotoFileInput = document.getElementById('memberPhotoFileInput');
            const memberPhotoPreview = document.getElementById('memberPhotoPreview');
            const saveMemberPhotoBtn = document.getElementById('saveMemberPhotoBtn');
            
            // Click vào area để mở file dialog
            memberPhotoUploadArea.addEventListener('click', function() {
                memberPhotoFileInput.click();
            });
            
            // Xử lý chọn file ảnh đảng viên
            memberPhotoFileInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    handleMemberPhotoFile(e.target.files[0]);
                }
            });
            
            // Hàm xử lý file ảnh đảng viên
            function handleMemberPhotoFile(file) {
                // Kiểm tra file type
                if (!file.type.match('image.*')) {
                    showToast('Vui lòng chọn file ảnh!', 'error');
                    return;
                }
                
                // Kiểm tra kích thước file (max 2MB)
                if (file.size > 2 * 1024 * 1024) {
                    showToast('File ảnh quá lớn! Vui lòng chọn file nhỏ hơn 2MB.', 'error');
                    return;
                }
                
                selectedMemberPhotoFile = file;
                
                // Hiển thị preview
                const reader = new FileReader();
                reader.onload = function(e) {
                    memberPhotoPreview.src = e.target.result;
                    memberPhotoPreview.style.display = 'block';
                    document.querySelector('#memberPhotoPreviewContainer i').style.display = 'none';
                    saveMemberPhotoBtn.style.display = 'inline-flex';
                };
                reader.readAsDataURL(file);
                
                showToast(`Đã chọn ảnh: ${file.name}`, 'info');
            }
            
            // Xử lý nút lưu ảnh đảng viên
            saveMemberPhotoBtn.addEventListener('click', saveMemberPhoto);
            
            // ====== MOBILE MENU TOGGLE ======
            
            document.getElementById('mobileMenuToggle').addEventListener('click', function() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('active');
                
                // Đổi icon
                const icon = this.querySelector('i');
                if (sidebar.classList.contains('active')) {
                    icon.className = 'fas fa-times';
                } else {
                    icon.className = 'fas fa-bars';
                }
            });
            
            // ====== MOBILE SEARCH TOGGLE ======
            
            if (window.innerWidth <= 768) {
                document.getElementById('mobileSearchToggle').addEventListener('click', function() {
                    const searchContainer = document.getElementById('searchContainer');
                    searchContainer.classList.toggle('active');
                });
            }
            
            // ====== SEARCH HANDLERS ======
            
            const searchInput = document.getElementById('globalSearch');
            const searchResults = document.getElementById('searchResults');
            
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const query = e.target.value.trim().toLowerCase();
                    
                    if (query.length === 0) {
                        if (searchResults) searchResults.style.display = 'none';
                        return;
                    }
                    
                    // Thêm đảng viên vào kết quả tìm kiếm
                    const allSearchData = [...searchData];
                    partyMembers.forEach(member => {
                        allSearchData.push({
                            id: member.id + 1000,
                            title: member.name,
                            subtitle: `Đảng viên - Mã: ${member.code} - ${member.branch}`,
                            category: "Đảng viên",
                            icon: "user",
                            action: `showMemberDetail(${member.id})`
                        });
                    });
                    
                    // Lọc kết quả
                    const filteredResults = allSearchData.filter(item => 
                        item.title.toLowerCase().includes(query) || 
                        item.subtitle.toLowerCase().includes(query) ||
                        item.category.toLowerCase().includes(query)
                    );
                    
                    // Hiển thị kết quả
                    if (filteredResults.length > 0 && searchResults) {
                        searchResults.innerHTML = '';
                        
                        filteredResults.forEach(result => {
                            const resultItem = document.createElement('div');
                            resultItem.className = 'search-result-item';
                            resultItem.innerHTML = `
                                <div class="search-result-icon">
                                    <i class="fas fa-${result.icon}"></i>
                                </div>
                                <div class="search-result-content">
                                    <div class="search-result-title">${result.title}</div>
                                    <div class="search-result-subtitle">${result.subtitle}</div>
                                </div>
                                <div class="search-result-category">${result.category}</div>
                            `;
                            
                            resultItem.addEventListener('click', function() {
                                searchInput.value = result.title;
                                searchResults.style.display = 'none';
                                showToast(`Đã chọn: ${result.title}`, 'info');
                            });
                            
                            searchResults.appendChild(resultItem);
                        });
                        
                        searchResults.style.display = 'block';
                    } else if (searchResults) {
                        searchResults.innerHTML = `
                            <div class="search-result-item" style="text-align: center; color: var(--medium-gray);">
                                Không tìm thấy kết quả phù hợp
                            </div>
                        `;
                        searchResults.style.display = 'block';
                    }
                });
                
                // Ẩn kết quả khi click ra ngoài
                document.addEventListener('click', function(e) {
                    const searchContainer = document.getElementById('searchContainer');
                    if (searchContainer && !searchContainer.contains(e.target) && searchResults) {
                        searchResults.style.display = 'none';
                    }
                });
            }
            
            // ====== NOTIFICATIONS HANDLERS ======
            
            // Đánh dấu tất cả đã đọc
            document.getElementById('markAllRead').addEventListener('click', function(e) {
                e.stopPropagation();
                notifications.forEach(n => n.read = true);
                updateNotificationCount();
                renderNotifications();
                showToast('Đã đánh dấu tất cả thông báo là đã đọc', 'success');
            });
            
            // Toggle dropdown
            document.getElementById('notificationBell').addEventListener('click', function(e) {
                e.stopPropagation();
                const dropdown = document.getElementById('notificationsDropdown');
                dropdown.classList.toggle('active');
                
                // Load notifications khi mở dropdown
                if (dropdown.classList.contains('active')) {
                    renderNotifications();
                }
            });
            
            // Ẩn dropdown khi click ra ngoài
            document.addEventListener('click', function(e) {
                const notificationsContainer = document.getElementById('notificationsContainer');
                if (notificationsContainer && !notificationsContainer.contains(e.target)) {
                    document.getElementById('notificationsDropdown').classList.remove('active');
                }
            });
            
            // ====== THEME HANDLERS ======
            
            // Kiểm tra theme đã lưu
            const savedTheme = localStorage.getItem('partySystemTheme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                document.getElementById('themeIcon').className = 'fas fa-sun';
            }
            
            // Xử lý đổi theme
            document.getElementById('themeSwitcher').addEventListener('click', toggleTheme);
            
            // ====== LOGIN/LOGOUT HANDLERS ======
            
            // Kiểm tra đăng nhập từ sessionStorage
            const savedUser = sessionStorage.getItem('partyUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    isLoggedIn = true;
                    loginModal.classList.remove('active');
                    updateUIAfterLogin();
                    showToast(`Chào mừng trở lại, ${currentUser.name}!`, 'success');
                } catch (e) {
                    console.error('Lỗi khi đọc thông tin người dùng:', e);
                    sessionStorage.removeItem('partyUser');
                }
            }
            
            // Xử lý đăng nhập
            loginForm.addEventListener('submit', function(event) {
                event.preventDefault();
                
                const username = document.getElementById('loginUsername').value.trim();
                const password = document.getElementById('loginPassword').value;
                
                // Hiển thị loading
                loadingOverlay.classList.add('active');
                
                // Giả lập delay xử lý
                setTimeout(() => {
                    loadingOverlay.classList.remove('active');
                    
                    // Tài khoản demo
                    const demoAccounts = {
                        'admin': { 
                            password: 'admin123', 
                            name: 'Quản trị viên Hệ thống', 
                            role: 'Administrator',
                            avatar: 'fas fa-user-shield'
                        },
                        'bithu_VP': { 
                            password: 'bithu123', 
                            name: 'Nguyễn Văn A', 
                            role: 'Bí thư - Văn phòng',
                            avatar: 'fas fa-user-tie'
                        },
                        'canbo': { 
                            password: 'canbo123', 
                            name: 'Trần Thị B', 
                            role: 'Cán bộ',
                            avatar: 'fas fa-user'
                        }
                    };
                    
                    if (demoAccounts[username] && demoAccounts[username].password === password) {
                        currentUser = {
                            username: username,
                            name: demoAccounts[username].name,
                            role: demoAccounts[username].role,
                            avatar: demoAccounts[username].avatar
                        };
                        
                        isLoggedIn = true;
                        
                        // Lưu vào sessionStorage
                        sessionStorage.setItem('partyUser', JSON.stringify(currentUser));
                        
                        // Cập nhật giao diện
                        updateUIAfterLogin();
                        
                        // Cập nhật thống kê với số lượng thực tế
                        updateDashboardStats();
                        
                        // Tải danh sách đảng viên với ảnh
                        loadMembersListWithPhotos();
                        
                        // Hiển thị thông báo
                        showToast('Đăng nhập thành công!', 'success');
                        
                        // Ẩn modal đăng nhập
                        loginModal.classList.remove('active');
                        
                        console.log(`✅ Đăng nhập thành công: ${currentUser.name}`);
                    } else {
                        showToast('Sai tên đăng nhập hoặc mật khẩu!', 'error');
                        console.log('❌ Đăng nhập thất bại');
                    }
                }, 1000);
            });
            
            // Cập nhật giao diện sau khi đăng nhập
            function updateUIAfterLogin() {
                currentUserName.textContent = currentUser.name;
                currentUserRole.textContent = currentUser.role;
                
                logoutBtn.style.display = 'flex';
                sidebar.classList.add('active');
                mainContent.classList.add('active');
                mainContent.classList.add('with-sidebar');
                footer.classList.add('active');
                
                // Cập nhật thống kê
                updateNotificationCount();
            }
            
            // Xử lý đăng xuất
            logoutBtn.addEventListener('click', function() {
                if (confirm('Bạn có chắc chắn muốn đăng xuất?')) {
                    isLoggedIn = false;
                    currentUser = null;
                    sessionStorage.removeItem('partyUser');
                    
                    // Reset giao diện
                    sidebar.classList.remove('active');
                    mainContent.classList.remove('active');
                    mainContent.classList.remove('with-sidebar');
                    footer.classList.remove('active');
                    logoutBtn.style.display = 'none';
                    currentUserName.textContent = 'Vui lòng đăng nhập';
                    currentUserRole.textContent = 'Chưa đăng nhập';
                    
                    // Hiển thị lại login modal
                    loginModal.classList.add('active');
                    
                    showToast('Đã đăng xuất thành công', 'info');
                    console.log('👋 Đã đăng xuất');
                }
            });
            
            // ====== INITIALIZE ======
            
            // Cập nhật thông báo lần đầu
            updateNotificationCount();
            
            // Xử lý responsive
            handleResponsive();
            window.addEventListener('resize', handleResponsive);
            
            // Giả lập thông báo mới mỗi 2 phút
            setInterval(simulateNewNotification, 120000);
            
            // Cập nhật thống kê mỗi 30 giây
            setInterval(updateDashboardStats, 30000);
            
            // Cập nhật lần đầu sau khi đăng nhập
            if (isLoggedIn) {
                setTimeout(() => {
                    updateDashboardStats();
                    loadMembersListWithPhotos();
                }, 1000);
            }
            
            console.log('✅ Hệ thống đã sẵn sàng');
            console.log(`📊 Tổng số đảng viên: ${partyMembers.length}`);
        });
    </script>
</body>
</html>
