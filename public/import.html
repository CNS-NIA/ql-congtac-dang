<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Import Dữ liệu Đảng viên</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .import-container {
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
        }
        
        .import-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .preview-card {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .preview-table {
            width: 100%;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .preview-table th {
            background: #e9ecef;
            padding: 8px;
        }
        
        .preview-table td {
            padding: 8px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .error-list {
            max-height: 200px;
            overflow-y: auto;
            font-size: 13px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        input[type="file"] {
            padding: 10px;
            border: 2px dashed #1a237e;
            border-radius: 8px;
            width: 100%;
            background: #f8f9fa;
        }
        
        input[type="text"], select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #1a237e;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .text-muted {
            color: #6c757d;
            font-size: 14px;
        }
        
        .nav-tabs {
            display: flex;
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 20px;
        }
        
        .tab-link {
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #6c757d;
            border-bottom: 3px solid transparent;
        }
        
        .tab-link.active {
            color: #1a237e;
            border-bottom-color: #1a237e;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h2><i class="fas fa-database"></i> Import Dữ liệu</h2>
                <p>Quản lý Công tác Đảng</p>
            </div>
            
            <nav>
                <a href="/"><i class="fas fa-arrow-left"></i> Về trang chủ</a>
                <a href="#" class="active"><i class="fas fa-file-import"></i> Import JSON</a>
                <a href="#"><i class="fas fa-list"></i> Danh sách đã import</a>
                <a href="#"><i class="fas fa-history"></i> Lịch sử import</a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <header>
                <h1><i class="fas fa-file-import"></i> Import Dữ liệu Đảng viên từ JSON</h1>
                <div class="user-info">
                    <span>Import tool</span>
                </div>
            </header>

            <div class="import-container">
                <!-- Thông báo -->
                <div id="importMessage" style="display: none;"></div>

                <!-- Tabs -->
                <div class="nav-tabs">
                    <button class="tab-link active" onclick="openTab(event, 'uploadTab')">
                        <i class="fas fa-upload"></i> Upload File
                    </button>
                    <button class="tab-link" onclick="openTab(event, 'urlTab')">
                        <i class="fas fa-link"></i> Từ URL
                    </button>
                    <button class="tab-link" onclick="openTab(event, 'batchTab')">
                        <i class="fas fa-folder"></i> Import Hàng loạt
                    </button>
                </div>

                <!-- Tab 1: Upload File -->
                <div id="uploadTab" class="tab-content active">
                    <div class="import-card">
                        <h3><i class="fas fa-upload"></i> Upload File JSON</h3>
                        <p class="text-muted">Tải lên file JSON chứa danh sách đảng viên (định dạng như ví dụ)</p>
                        
                        <form id="uploadForm">
                            <div class="form-group">
                                <label for="jsonFile"><i class="fas fa-file-code"></i> Chọn file JSON:</label>
                                <input type="file" id="jsonFile" name="jsonFile" accept=".json" required>
                                <small class="text-muted">Hỗ trợ định dạng JSON chuẩn với cấu trúc mảng</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="chiBoSelect"><i class="fas fa-sitemap"></i> Chi bộ (tùy chọn):</label>
                                <select id="chiBoSelect" name="chiBo">
                                    <option value="">-- Đang tải... --</option>
                                </select>
                                <small class="text-muted">Để trống để tự động nhận diện từ tên file</small>
                            </div>
                            
                            <div id="filePreview" style="display: none;"></div>
                            
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-file-import"></i> Bắt đầu Import
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Tab 2: Từ URL -->
                <div id="urlTab" class="tab-content">
                    <div class="import-card">
                        <h3><i class="fas fa-link"></i> Import từ URL</h3>
                        <p class="text-muted">Nhập URL trực tiếp đến file JSON</p>
                        
                        <div class="form-group">
                            <label for="jsonUrl"><i class="fas fa-globe"></i> URL file JSON:</label>
                            <input type="text" id="jsonUrl" placeholder="https://example.com/data/doi-bao-tri-san-duong.json">
                        </div>
                        
                        <div class="form-group">
                            <label for="chiBoSelect2"><i class="fas fa-sitemap"></i> Chi bộ:</label>
                            <select id="chiBoSelect2">
                                <option value="">-- Đang tải... --</option>
                            </select>
                        </div>
                        
                        <button id="importUrlBtn" class="btn btn-primary">
                            <i class="fas fa-download"></i> Import từ URL
                        </button>
                    </div>
                </div>

                <!-- Tab 3: Import hàng loạt -->
                <div id="batchTab" class="tab-content">
                    <div class="import-card">
                        <h3><i class="fas fa-folder"></i> Import Hàng loạt</h3>
                        <p class="text-muted">Upload nhiều file JSON cùng lúc (tối đa 10 files)</p>
                        
                        <div class="form-group">
                            <label><i class="fas fa-folder-open"></i> Chọn nhiều files:</label>
                            <input type="file" id="batchFiles" multiple accept=".json">
                        </div>
                        
                        <div id="batchPreview"></div>
                        
                        <button id="batchImportBtn" class="btn btn-success" disabled>
                            <i class="fas fa-play"></i> Import Tất cả
                        </button>
                    </div>
                </div>

                <!-- Hướng dẫn -->
                <div class="import-card">
                    <h3><i class="fas fa-info-circle"></i> Hướng dẫn & Lưu ý</h3>
                    
                    <div class="alert alert-info">
                        <h4><i class="fas fa-lightbulb"></i> Cấu trúc JSON yêu cầu:</h4>
                        <pre><code>[
    {
        "STT": 1,
        "Ho_va_Ten": "Nguyễn Văn A",
        "Ngay_sinh": "15.05.1976",
        "So_the_Dang": "83.016532",
        "Chuc_vu": "Nhân viên",
        "Trinh_do": "12/12 - KS",
        "Que_quan": "Hà Nội",
        "Chuc_vu_Dang": "",
        "Ngay_vao_Dang": "31.12.2009"
    },
    ...
]</code></pre>
                    </div>
                    
                    <h4>Các định dạng ngày hỗ trợ:</h4>
                    <ul>
                        <li><code>15.05.1976</code> (định dạng dấu chấm)</li>
                        <li><code>15/05/1976</code> (định dạng dấu gạch chéo)</li>
                        <li><code>15-05-1976</code> (định dạng dấu gạch ngang)</li>
                        <li><code>15.05.76</code> (năm 2 chữ số, tự động chuyển thành 1976)</li>
                    </ul>
                    
                    <h4>Quy trình import:</h4>
                    <ol>
                        <li>Chọn file JSON có cấu trúc đúng</li>
                        <li>Hệ thống tự động nhận diện chi bộ từ tên file</li>
                        <li>Kiểm tra trùng số thẻ đảng (cập nhật nếu đã tồn tại)</li>
                        <li>Thêm mới các đảng viên chưa có trong hệ thống</li>
                        <li>Cập nhật tự động danh sách trên trang chủ</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script src="js/import.js"></script>
    <script>
        // Tab switching
        function openTab(evt, tabName) {
            const tablinks = document.querySelectorAll('.tab-link');
            const tabcontents = document.querySelectorAll('.tab-content');
            
            tablinks.forEach(tab => tab.classList.remove('active'));
            tabcontents.forEach(tab => tab.classList.remove('active'));
            
            evt.currentTarget.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        // Batch import preview
        document.getElementById('batchFiles')?.addEventListener('change', function(e) {
            const files = e.target.files;
            const previewDiv = document.getElementById('batchPreview');
            const importBtn = document.getElementById('batchImportBtn');
            
            if (files.length === 0) {
                previewDiv.innerHTML = '';
                importBtn.disabled = true;
                return;
            }
            
            let html = `<h4>${files.length} files được chọn:</h4><ul>`;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                html += `<li><i class="fas fa-file"></i> ${file.name} (${(file.size/1024).toFixed(2)} KB)</li>`;
            }
            
            html += '</ul>';
            previewDiv.innerHTML = html;
            importBtn.disabled = false;
        });
    </script>
</body>
</html>
